!function(context){function Lazy(a){if(a instanceof Array)return new ArrayWrapper(a);if("string"==typeof a)return new StringWrapper(a);if(a instanceof Sequence)return a;if(Lazy.extensions){for(var b,c=Lazy.extensions,d=c.length;!b&&d--;)b=c[d](a);if(b)return b}return new ObjectWrapper(a)}function Sequence(){}function Iterator(a){this.sequence=a,this.index=-1}function MemoizedSequence(a){this.parent=a}function MappedSequence(a,b){this.parent=a,this.mapFn=b}function MappingIterator(a,b){this.iterator=a.getIterator(),this.mapFn=b,this.index=-1}function FilteredSequence(a,b){this.parent=a,this.filterFn=b}function FilteringIterator(a,b){this.iterator=a.getIterator(),this.filterFn=b,this.index=0}function ReversedSequence(a){this.parent=a}function ReversedIterator(a){this.sequence=a}function ConcatenatedSequence(a,b){this.parent=a,this.arrays=b}function TakeSequence(a,b){this.parent=a,this.count=b}function TakeIterator(a,b){this.iterator=a.getIterator(),this.count=b}function TakeWhileSequence(a,b){this.parent=a,this.predicate=b}function DropSequence(a,b){this.parent=a,this.count="number"==typeof b?b:1}function DropWhileSequence(a,b){this.parent=a,this.predicate=b}function SortedSequence(a,b){this.parent=a,this.sortFn=b}function GroupedSequence(a,b){this.parent=a,this.keyFn=b}function CountedSequence(a,b){this.parent=a,this.keyFn=b}function UniqueSequence(a,b){this.parent=a,this.keyFn=b}function ZippedSequence(a,b){this.parent=a,this.arrays=b}function ShuffledSequence(a){this.parent=a}function FlattenedSequence(a){this.parent=a}function WithoutSequence(a,b){this.parent=a,this.values=b}function IntersectionSequence(a,b){this.parent=a,this.arrays=b}function UniqueMemoizer(a){this.iterator=a,this.set=new Set,this.memo=[],this.currentValue=void 0}function ChunkedSequence(a,b){this.parent=a,this.chunkSize=b}function ChunkedIterator(a,b){this.iterator=a.getIterator(),this.size=b}function TappedSequence(a,b){this.parent=a,this.callback=b}function SimpleIntersectionSequence(a,b){this.parent=a,this.array=b,this.each=getEachForIntersection(b)}function getEachForIntersection(a){return a.length<40?SimpleIntersectionSequence.prototype.eachArrayCache:SimpleIntersectionSequence.prototype.eachMemoizerCache}function SimpleZippedSequence(a,b){this.parent=a,this.array=b}function ArrayLikeSequence(){}function IndexedIterator(a){this.sequence=a,this.index=-1}function IndexedMappedSequence(a,b){this.parent=a,this.mapFn=b}function IndexedFilteredSequence(a,b){this.parent=a,this.filterFn=b}function IndexedReversedSequence(a){this.parent=a}function IndexedTakeSequence(a,b){this.parent=a,this.count=b}function IndexedDropSequence(a,b){this.parent=a,this.count="number"==typeof b?b:1}function IndexedConcatenatedSequence(a,b){this.parent=a,this.other=b}function IndexedUniqueSequence(a,b){this.parent=a,this.each=getEachForParent(a),this.keyFn=b}function getEachForParent(a){return a.length()<100?IndexedUniqueSequence.prototype.eachArrayCache:UniqueSequence.prototype.each}function ArrayWrapper(a){this.source=a}function MappedArrayWrapper(a,b){this.parent=a,this.mapFn=b}function FilteredArrayWrapper(a,b){this.parent=a,this.filterFn=b}function UniqueArrayWrapper(a,b){this.parent=a,this.each=getEachForSource(a.source),this.keyFn=b}function getEachForSource(a){return a.length<40?UniqueArrayWrapper.prototype.eachNoCache:a.length<100?UniqueArrayWrapper.prototype.eachArrayCache:UniqueArrayWrapper.prototype.eachSetCache}function ConcatArrayWrapper(a,b){this.parent=a,this.other=b}function ObjectLikeSequence(){}function AssignSequence(a,b){this.parent=a,this.other=b}function DefaultsSequence(a,b){this.parent=a,this.defaults=b}function InvertedSequence(a){this.parent=a}function MergedSequence(a,b,c){this.parent=a,this.others=b,this.mergeFn=c}function mergeObjects(a,b){if("undefined"==typeof b)return a;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return b;var c,d={};for(c in a)d[c]=mergeObjects(a[c],b[c]);for(c in b)d[c]||(d[c]=b[c]);return d}function PickSequence(a,b){this.parent=a,this.properties=b}function OmitSequence(a,b){this.parent=a,this.properties=b}function ObjectWrapper(a){this.source=a}function StringLikeSequence(){}function CharIterator(a){this.source=Lazy(a),this.index=-1}function StringSegment(a,b,c){this.parent=a,this.start=Math.max(0,b),this.stop=c}function MappedStringLikeSequence(a,b){this.parent=a,this.mapFn=b}function ReversedStringLikeSequence(a){this.parent=a}function StringMatchSequence(a,b){this.source=a,this.pattern=b}function StringMatchIterator(a,b){this.source=a,this.pattern=cloneRegex(b)}function SplitStringSequence(a,b){this.source=a,this.pattern=b}function SplitWithRegExpIterator(a,b){this.source=a,this.pattern=cloneRegex(b)}function SplitWithStringIterator(a,b){this.source=a,this.delimiter=b}function StringWrapper(a){this.source=a}function GeneratedSequence(a,b){this.get=a,this.fixedLength=b}function GeneratedIterator(a){this.sequence=a,this.index=0,this.currentValue=null}function AsyncSequence(a,b){if(a instanceof AsyncSequence)throw"Sequence is already asynchronous!";this.parent=a,this.interval=b,this.onNextCallback=getOnNextCallback(b)}function AsyncHandle(a){this.cancelCallback=getCancelCallback(a)}function getOnNextCallback(a){return"undefined"==typeof a&&"function"==typeof setImmediate?setImmediate:(a=a||0,function(b){return setTimeout(b,a)})}function getCancelCallback(a){return"undefined"==typeof a&&"function"==typeof clearImmediate?clearImmediate:clearTimeout}function WatchedPropertySequence(a,b){this.listeners=[],b?b instanceof Array||(b=[b]):b=Lazy(a).keys().toArray();var c=this.listeners,d=0;Lazy(b).each(function(b){var e=a[b];Object.defineProperty(a,b,{get:function(){return e},set:function(a){for(var f=c.length-1;f>=0;--f)c[f]({property:b,value:a},d)===!1&&c.splice(f,1);e=a,++d}})})}function StreamLikeSequence(){}function SplitStreamSequence(a,b){this.parent=a,this.delimiter=b}function MatchedStreamSequence(a,b){this.parent=a,this.pattern=cloneRegex(b)}function createCallback(a,b){switch(typeof a){case"function":return a;case"string":return function(b){return b[a]};case"object":return function(b){return Lazy(a).all(function(a,c){return b[c]===a})};case"undefined":return b?function(){return b}:Lazy.identity;default:throw"Don't know how to make a callback from a "+typeof a+"!"}}function createSet(a){var b=new Set;return Lazy(a||[]).flatten().each(function(a){b.add(a)}),b}function compare(a,b,c){return"function"==typeof c?compare(c(a),c(b)):a===b?0:a>b?1:-1}function forEach(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c)===!1)return!1;return!0}function getFirst(a){var b;return a.each(function(a){return b=a,!1}),b}function arrayContains(a,b){var c=-1,d=a.length;if(b!==b){for(;++c<d;)if(a[c]!==a[c])return!0;return!1}for(;++c<d;)if(a[c]===b)return!0;return!1}function arrayContainsBefore(a,b,c,d){var e=-1;if(d){for(d=createCallback(d);++e<c;)if(d(a[e])===d(b))return!0}else for(;++e<c;)if(a[e]===b)return!0;return!1}function swap(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function cloneRegex(pattern){return eval(""+pattern+(pattern.global?"":"g"))}function Set(){this.table={},this.objects=[]}function Queue(a){this.contents=new Array(a),this.start=0,this.count=0}function defineSequenceType(a,b,c){var d=function(){};d.prototype=new a;for(var e in c)d.prototype[e]=c[e];for(var f=function(){var a=new d;return a.parent=this,a.init&&a.init.apply(a,arguments),a},g="string"==typeof b?[b]:b,h=0;h<g.length;++h)a.prototype[g[h]]=f;return d}Lazy.VERSION="0.3.2",Lazy.noop=function(){},Lazy.identity=function(a){return a},Lazy.strict=function(){function a(a){if(null==a)throw"You cannot wrap null or undefined using Lazy.";if("number"==typeof a||"boolean"==typeof a)throw"You cannot wrap primitive values using Lazy.";return Lazy(a)}return Lazy(Lazy).each(function(b,c){a[c]=b}),a},Sequence.define=function(a,b){if(!b||!b.getIterator&&!b.each)throw"A custom sequence must implement *at least* getIterator or each!";return defineSequenceType(Sequence,a,b)},Sequence.prototype.size=function(){return this.getIndex().length()},Sequence.prototype.getIterator=function(){return new Iterator(this)},Sequence.prototype.root=function(){return this.parent.root()},Sequence.prototype.value=function(){return this.toArray()},Sequence.prototype.apply=function(a){var b,c=this.root(),d=c.source;try{c.source=a,b=this.value()}finally{c.source=d}return b},Iterator.prototype.current=function(){return this.cachedIndex&&this.cachedIndex.get(this.index)},Iterator.prototype.moveNext=function(){var a=this.cachedIndex;return a||(a=this.cachedIndex=this.sequence.getIndex()),this.index>=a.length()-1?!1:(++this.index,!0)},Sequence.prototype.toArray=function(){return this.reduce(function(a,b){return a.push(b),a},[])},Sequence.prototype.getIndex=function(){return this.cachedIndex||(this.cachedIndex=new ArrayWrapper(this.toArray())),this.cachedIndex},Sequence.prototype.memoize=function(){return new MemoizedSequence(this)},Sequence.prototype.toObject=function(){return this.reduce(function(a,b){return a[b[0]]=b[1],a},{})},Sequence.prototype.each=function(a){for(var b=this.getIterator(),c=-1;b.moveNext();)if(a(b.current(),++c)===!1)return!1;return!0},Sequence.prototype.forEach=function(a){return this.each(a)},Sequence.prototype.map=function(a){return new MappedSequence(this,createCallback(a))},Sequence.prototype.collect=function(a){return this.map(a)},MappedSequence.prototype=new Sequence,MappedSequence.prototype.getIterator=function(){return new MappingIterator(this.parent,this.mapFn)},MappedSequence.prototype.each=function(a){var b=this.mapFn;return this.parent.each(function(c,d){return a(b(c,d),d)})},MappingIterator.prototype.current=function(){return this.mapFn(this.iterator.current(),this.index)},MappingIterator.prototype.moveNext=function(){return this.iterator.moveNext()?(++this.index,!0):!1},Sequence.prototype.pluck=function(a){return this.map(a)},Sequence.prototype.invoke=function(a){return this.map(function(b){return b[a]()})},Sequence.prototype.filter=function(a){return new FilteredSequence(this,createCallback(a))},Sequence.prototype.select=function(a){return this.filter(a)},FilteredSequence.prototype=new Sequence,FilteredSequence.prototype.getIterator=function(){return new FilteringIterator(this.parent,this.filterFn)},FilteredSequence.prototype.each=function(a){var b=this.filterFn;return this.parent.each(function(c,d){return b(c,d)?a(c,d):void 0})},FilteredSequence.prototype.reverse=function(){return this.parent.reverse().filter(this.filterFn)},FilteringIterator.prototype.current=function(){return this.value},FilteringIterator.prototype.moveNext=function(){for(var a,b=this.iterator,c=this.filterFn;b.moveNext();)if(a=b.current(),c(a,this.index++))return this.value=a,!0;return this.value=void 0,!1},Sequence.prototype.reject=function(a){return a=createCallback(a),this.filter(function(b){return!a(b)})},Sequence.prototype.ofType=function(a){return this.filter(function(b){return typeof b===a})},Sequence.prototype.where=function(a){return this.filter(a)},Sequence.prototype.reverse=function(){return new ReversedSequence(this)},ReversedSequence.prototype=new Sequence,ReversedSequence.prototype.getIterator=function(){return new ReversedIterator(this.parent)},ReversedIterator.prototype.current=function(){return this.sequence.getIndex().get(this.index)},ReversedIterator.prototype.moveNext=function(){var a=this.sequence.getIndex(),b=a.length();return"undefined"==typeof this.index&&(this.index=b),--this.index>=0},Sequence.prototype.concat=function(){return new ConcatenatedSequence(this,arraySlice.call(arguments,0))},ConcatenatedSequence.prototype=new Sequence,ConcatenatedSequence.prototype.each=function(a){var b=!1,c=0;this.parent.each(function(d){return a(d,c++)===!1?(b=!0,!1):void 0}),b||Lazy(this.arrays).flatten().each(function(b){return a(b,c++)===!1?!1:void 0})},Sequence.prototype.first=function(a){return"undefined"==typeof a?getFirst(this):new TakeSequence(this,a)},Sequence.prototype.head=Sequence.prototype.take=function(a){return this.first(a)},TakeSequence.prototype=new Sequence,TakeSequence.prototype.getIterator=function(){return new TakeIterator(this.parent,this.count)},TakeSequence.prototype.each=function(a){var b=this.count,c=0;this.parent.each(function(d){var e;return b>c&&(e=a(d,c)),++c>=b?!1:e})},TakeIterator.prototype.current=function(){return this.iterator.current()},TakeIterator.prototype.moveNext=function(){return--this.count>=0&&this.iterator.moveNext()},Sequence.prototype.takeWhile=function(a){return new TakeWhileSequence(this,a)},TakeWhileSequence.prototype=new Sequence,TakeWhileSequence.prototype.each=function(a){var b=this.predicate;this.parent.each(function(c){return b(c)&&a(c)})},Sequence.prototype.initial=function(a){return"undefined"==typeof a&&(a=1),this.take(this.getIndex().length()-a)},Sequence.prototype.last=function(a){return"undefined"==typeof a?this.reverse().first():this.reverse().take(a).reverse()},Sequence.prototype.findWhere=function(a){return this.where(a).first()},Sequence.prototype.rest=function(a){return new DropSequence(this,a)},Sequence.prototype.skip=Sequence.prototype.tail=Sequence.prototype.drop=function(a){return this.rest(a)},DropSequence.prototype=new Sequence,DropSequence.prototype.each=function(a){var b=this.count,c=0,d=0;this.parent.each(function(e){return c++<b?void 0:a(e,d++)})},Sequence.prototype.dropWhile=function(a){return new DropWhileSequence(this,a)},Sequence.prototype.skipWhile=function(a){return this.dropWhile(a)},DropWhileSequence.prototype=new Sequence,DropWhileSequence.prototype.each=function(a){var b=this.predicate,c=!1;this.parent.each(function(d){if(!c){if(b(d))return;c=!0}return a(d)})},Sequence.prototype.sortBy=function(a){return new SortedSequence(this,a)},SortedSequence.prototype=new Sequence,SortedSequence.prototype.each=function(a){var b=createCallback(this.sortFn),c=this.parent.toArray();return c.sort(function(a,c){return compare(a,c,b)}),forEach(c,a)},Sequence.prototype.groupBy=function(a){return new GroupedSequence(this,a)},Sequence.prototype.countBy=function(a){return new CountedSequence(this,a)},Sequence.prototype.uniq=function(a){return new UniqueSequence(this,a)},Sequence.prototype.unique=function(a){return this.uniq(a)},UniqueSequence.prototype=new Sequence,UniqueSequence.prototype.each=function(a){var b=new Set,c=this.keyFn,d=0;return c?(c=createCallback(c),this.parent.each(function(e){return b.add(c(e))?a(e,d++):void 0})):this.parent.each(function(c){return b.add(c)?a(c,d++):void 0})},Sequence.prototype.zip=function(a){return 1===arguments.length?new SimpleZippedSequence(this,a):new ZippedSequence(this,arraySlice.call(arguments,0))},ZippedSequence.prototype=new Sequence,ZippedSequence.prototype.each=function(a){var b=this.arrays,c=0;this.parent.each(function(d){for(var e=[d],f=0;f<b.length;++f)b[f].length>c&&e.push(b[f][c]);return a(e,c++)})},Sequence.prototype.shuffle=function(){return new ShuffledSequence(this)},ShuffledSequence.prototype=new Sequence,ShuffledSequence.prototype.each=function(a){for(var b=this.parent.toArray(),c=Math.floor,d=Math.random,e=0,f=b.length-1;f>0;--f)if(swap(b,f,c(d()*f)+1),a(b[f],e++)===!1)return;a(b[0],e)},Sequence.prototype.flatten=function(){return new FlattenedSequence(this)},FlattenedSequence.prototype=new Sequence,FlattenedSequence.prototype.each=function(a){var b=0;return this.parent.each(function c(d){return d instanceof Array?forEach(d,c):d instanceof Sequence?d.each(c):a(d,b++)})},Sequence.prototype.compact=function(){return this.filter(function(a){return!!a})},Sequence.prototype.without=function(){return new WithoutSequence(this,arraySlice.call(arguments,0))},Sequence.prototype.difference=function(){return this.without.apply(this,arguments)},WithoutSequence.prototype=new Sequence,WithoutSequence.prototype.each=function(a){var b=createSet(this.values),c=0;return this.parent.each(function(d){return b.contains(d)?void 0:a(d,c++)})},Sequence.prototype.union=function(a){return this.concat(a).uniq()},Sequence.prototype.intersection=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new SimpleIntersectionSequence(this,a):new IntersectionSequence(this,arraySlice.call(arguments,0))},IntersectionSequence.prototype=new Sequence,IntersectionSequence.prototype.each=function(a){var b=Lazy(this.arrays).map(function(a){return new UniqueMemoizer(Lazy(a).getIterator())}),c=new UniqueMemoizer(b.getIterator()),d=0;return this.parent.each(function(b){var e=!0;return c.each(function(a){return a.contains(b)?void 0:(e=!1,!1)}),e?a(b,d++):void 0})},UniqueMemoizer.prototype.current=function(){return this.currentValue},UniqueMemoizer.prototype.moveNext=function(){for(var a,b=this.iterator,c=this.set,d=this.memo;b.moveNext();)if(a=b.current(),c.add(a))return d.push(a),this.currentValue=a,!0;return!1},UniqueMemoizer.prototype.each=function(a){for(var b=this.memo,c=b.length,d=-1;++d<c;)if(a(b[d],d)===!1)return!1;for(;this.moveNext()&&a(this.currentValue,d++)!==!1;);},UniqueMemoizer.prototype.contains=function(a){if(this.set.contains(a))return!0;for(;this.moveNext();)if(this.currentValue===a)return!0;return!1},Sequence.prototype.every=function(a){return a=createCallback(a),this.each(function(b,c){return!!a(b,c)})},Sequence.prototype.all=function(a){return this.every(a)},Sequence.prototype.some=function(a){a=createCallback(a,!0);var b=!1;return this.each(function(c){return a(c)?(b=!0,!1):void 0}),b},Sequence.prototype.any=function(a){return this.some(a)},Sequence.prototype.none=function(a){return!this.any(a)},Sequence.prototype.isEmpty=function(){return!this.any()},Sequence.prototype.indexOf=function(a){var b=-1;return this.each(function(c,d){return c===a?(b=d,!1):void 0}),b},Sequence.prototype.lastIndexOf=function(a){var b=this.reverse().indexOf(a);return-1!==b&&(b=this.getIndex().length()-b-1),b},Sequence.prototype.sortedIndex=function(a){for(var b,c=this.getIndex(),d=0,e=c.length();e>d;)b=d+e>>>1,-1===compare(c.get(b),a)?d=b+1:e=b;return d},Sequence.prototype.contains=function(a){return-1!==this.indexOf(a)},Sequence.prototype.reduce=function(a,b){return arguments.length<2?this.tail().reduce(a,this.head()):(this.each(function(c,d){b=a(b,c,d)}),b)},Sequence.prototype.inject=Sequence.prototype.foldl=function(a,b){return this.reduce(a,b)},Sequence.prototype.reduceRight=function(a,b){if(arguments.length<2)return this.initial(1).reduceRight(a,this.last());var c=this.getIndex().length()-1;return this.reverse().reduce(function(b,d){return a(b,d,c--)},b)},Sequence.prototype.foldr=function(a,b){return this.reduceRight(a,b)},Sequence.prototype.consecutive=function(a){var b=new Queue(a),c=this.map(function(c){return b.add(c).count===a?b.toArray():void 0});return c.compact()},Sequence.prototype.chunk=function(a){if(1>a)throw"You must specify a positive chunk size.";return new ChunkedSequence(this,a)},ChunkedSequence.prototype=new Sequence,ChunkedSequence.prototype.getIterator=function(){return new ChunkedIterator(this.parent,this.chunkSize)},ChunkedIterator.prototype.current=function(){return this.currentChunk},ChunkedIterator.prototype.moveNext=function(){for(var a=this.iterator,b=this.size,c=[];c.length<b&&a.moveNext();)c.push(a.current());return 0===c.length?!1:(this.currentChunk=c,!0)},Sequence.prototype.tap=function(a){return new TappedSequence(this,a)},TappedSequence.prototype=new Sequence,TappedSequence.prototype.each=function(a){var b=this.callback;return this.parent.each(function(c,d){return b(c,d),a(c,d)})},Sequence.prototype.find=function(a){return this.filter(a).first()},Sequence.prototype.detect=function(a){return this.find(a)},Sequence.prototype.min=function(a){return"undefined"!=typeof a?this.minBy(a):this.reduce(function(a,b){return a>b?b:a},1/0)},Sequence.prototype.minBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return a(c)<a(b)?c:b})},Sequence.prototype.max=function(a){return"undefined"!=typeof a?this.maxBy(a):this.reduce(function(a,b){return b>a?b:a},-1/0)},Sequence.prototype.maxBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return a(c)>a(b)?c:b})},Sequence.prototype.sum=function(a){return"undefined"!=typeof a?this.sumBy(a):this.reduce(function(a,b){return a+b},0)},Sequence.prototype.sumBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return b+a(c)},0)},Sequence.prototype.join=function(a){return a="string"==typeof a?a:",",this.reduce(function(b,c){return b.length>0&&(b+=a),b+c},"")},Sequence.prototype.toString=function(a){return this.join(a)},Sequence.prototype.async=function(a){return new AsyncSequence(this,a)},SimpleIntersectionSequence.prototype=new Sequence,SimpleIntersectionSequence.prototype.eachMemoizerCache=function(a){var b=new UniqueMemoizer(Lazy(this.array).getIterator()),c=0;return this.parent.each(function(d){return b.contains(d)?a(d,c++):void 0})},SimpleIntersectionSequence.prototype.eachArrayCache=function(a){var b=this.array,c=arrayContains,d=0;return this.parent.each(function(e){return c(b,e)?a(e,d++):void 0})},SimpleZippedSequence.prototype=new Sequence,SimpleZippedSequence.prototype.each=function(a){var b=this.array;return this.parent.each(function(c,d){return a([c,b[d]],d)})},ArrayLikeSequence.prototype=new Sequence,ArrayLikeSequence.define=function(a,b){if(!b||"function"!=typeof b.get)throw"A custom array-like sequence must implement *at least* get!";return defineSequenceType(ArrayLikeSequence,a,b)},ArrayLikeSequence.prototype.get=function(a){return this.parent.get(a)},ArrayLikeSequence.prototype.length=function(){return this.parent.length()},ArrayLikeSequence.prototype.getIndex=function(){return this},ArrayLikeSequence.prototype.getIterator=function(){return new IndexedIterator(this)},IndexedIterator.prototype.current=function(){return this.sequence.get(this.index)},IndexedIterator.prototype.moveNext=function(){return this.index>=this.sequence.length()-1?!1:(++this.index,!0)},ArrayLikeSequence.prototype.each=function(a){for(var b=this.length(),c=-1;++c<b;)if(a(this.get(c),c)===!1)return!1;return!0},ArrayLikeSequence.prototype.pop=function(){return this.initial()},ArrayLikeSequence.prototype.shift=function(){return this.drop()},ArrayLikeSequence.prototype.slice=function(a,b){var c=this.length();0>a&&(a=c+a);var d=this.drop(a);return"number"==typeof b&&(0>b&&(b=c+b),d=d.take(b-a)),d},ArrayLikeSequence.prototype.map=function(a){return new IndexedMappedSequence(this,createCallback(a))},IndexedMappedSequence.prototype=new ArrayLikeSequence,IndexedMappedSequence.prototype.get=function(a){return 0>a||a>=this.parent.length()?void 0:this.mapFn(this.parent.get(a),a)},ArrayLikeSequence.prototype.filter=function(a){return new IndexedFilteredSequence(this,createCallback(a))},IndexedFilteredSequence.prototype=new FilteredSequence,IndexedFilteredSequence.prototype.each=function(a){for(var b,c=this.parent,d=this.filterFn,e=this.parent.length(),f=-1;++f<e;)if(b=c.get(f),d(b,f)&&a(b,f)===!1)return!1;return!0},ArrayLikeSequence.prototype.reverse=function(){return new IndexedReversedSequence(this)},IndexedReversedSequence.prototype=new ArrayLikeSequence,IndexedReversedSequence.prototype.get=function(a){return this.parent.get(this.length()-a-1)},ArrayLikeSequence.prototype.first=function(a){return"undefined"==typeof a?this.get(0):new IndexedTakeSequence(this,a)},IndexedTakeSequence.prototype=new ArrayLikeSequence,IndexedTakeSequence.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a},ArrayLikeSequence.prototype.rest=function(a){return new IndexedDropSequence(this,a)},IndexedDropSequence.prototype=new ArrayLikeSequence,IndexedDropSequence.prototype.get=function(a){return this.parent.get(this.count+a)},IndexedDropSequence.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0},ArrayLikeSequence.prototype.concat=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new IndexedConcatenatedSequence(this,a):Sequence.prototype.concat.apply(this,arguments)},IndexedConcatenatedSequence.prototype=new ArrayLikeSequence,IndexedConcatenatedSequence.prototype.get=function(a){var b=this.parent.length();return b>a?this.parent.get(a):this.other[a-b]},IndexedConcatenatedSequence.prototype.length=function(){return this.parent.length()+this.other.length},ArrayLikeSequence.prototype.uniq=function(a){return new IndexedUniqueSequence(this,createCallback(a))},IndexedUniqueSequence.prototype=new Sequence,IndexedUniqueSequence.prototype.eachArrayCache=function(a){for(var b,c,d=this.parent,e=this.keyFn,f=d.length(),g=[],h=arrayContains,i=-1,j=0;++i<f;)if(c=d.get(i),b=e(c),!h(g,b)&&(g.push(b),a(c,j++)===!1))return!1},IndexedUniqueSequence.prototype.eachSetCache=UniqueSequence.prototype.each,MemoizedSequence.prototype=new ArrayLikeSequence,MemoizedSequence.prototype.cache=function(){return this.cachedResult||(this.cachedResult=this.parent.toArray())},MemoizedSequence.prototype.get=function(a){return this.cache()[a]},MemoizedSequence.prototype.length=function(){return this.cache().length},MemoizedSequence.prototype.slice=function(a,b){return this.cache().slice(a,b)},MemoizedSequence.prototype.toArray=function(){return this.cache().slice(0)},ArrayWrapper.prototype=new ArrayLikeSequence,ArrayWrapper.prototype.root=function(){return this},ArrayWrapper.prototype.get=function(a){return this.source[a]},ArrayWrapper.prototype.length=function(){return this.source.length},ArrayWrapper.prototype.each=function(a){return forEach(this.source,a)},ArrayWrapper.prototype.map=ArrayWrapper.prototype.collect=function(a){return new MappedArrayWrapper(this,createCallback(a))},ArrayWrapper.prototype.filter=ArrayWrapper.prototype.select=function(a){return new FilteredArrayWrapper(this,createCallback(a))},ArrayWrapper.prototype.uniq=ArrayWrapper.prototype.unique=function(a){return new UniqueArrayWrapper(this,a)},ArrayWrapper.prototype.concat=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new ConcatArrayWrapper(this,a):ArrayLikeSequence.prototype.concat.apply(this,arguments)},ArrayWrapper.prototype.toArray=function(){return this.source.slice(0)},MappedArrayWrapper.prototype=new ArrayLikeSequence,MappedArrayWrapper.prototype.get=function(a){var b=this.parent.source;return 0>a||a>=b.length?void 0:this.mapFn(b[a])},MappedArrayWrapper.prototype.length=function(){return this.parent.source.length},MappedArrayWrapper.prototype.each=function(a){for(var b=this.parent.source,c=b.length,d=this.mapFn,e=-1;++e<c;)if(a(d(b[e],e),e)===!1)return!1;return!0},FilteredArrayWrapper.prototype=new FilteredSequence,FilteredArrayWrapper.prototype.each=function(a){for(var b,c=this.parent.source,d=this.filterFn,e=c.length,f=-1;++f<e;)if(b=c[f],d(b,f)&&a(b,f)===!1)return!1;return!0},UniqueArrayWrapper.prototype=new Sequence,UniqueArrayWrapper.prototype.eachNoCache=function(a){for(var b,c=this.parent.source,d=this.keyFn,e=c.length,f=arrayContainsBefore,g=-1,h=0;++g<e;)if(b=c[g],!f(c,b,g,d)&&a(b,h++)===!1)return!1;return!0},UniqueArrayWrapper.prototype.eachArrayCache=function(a){var b,c,d=this.parent.source,e=this.keyFn,f=d.length,g=[],h=arrayContains,i=-1,j=0;if(e){for(e=createCallback(e);++i<f;)if(c=d[i],b=e(c),!h(g,b)&&(g.push(b),a(c,j++)===!1))return!1}else for(;++i<f;)if(c=d[i],!h(g,c)&&(g.push(c),a(c,j++)===!1))return!1;return!0},UniqueArrayWrapper.prototype.eachSetCache=UniqueSequence.prototype.each,ConcatArrayWrapper.prototype=new ArrayLikeSequence,ConcatArrayWrapper.prototype.get=function(a){var b=this.parent.source,c=b.length;return c>a?b[a]:this.other[a-c]},ConcatArrayWrapper.prototype.length=function(){return this.parent.source.length+this.other.length},ConcatArrayWrapper.prototype.each=function(a){for(var b=this.parent.source,c=b.length,d=this.other,e=d.length,f=0,g=-1;++g<c;)if(a(b[g],f++)===!1)return!1;for(g=-1;++g<e;)if(a(d[g],f++)===!1)return!1;return!0},ObjectLikeSequence.prototype=new Sequence,ObjectLikeSequence.define=function(a,b){if(!b||"function"!=typeof b.each)throw"A custom object-like sequence must implement *at least* each!";return defineSequenceType(ObjectLikeSequence,a,b)},ObjectLikeSequence.prototype.value=function(){return this.toObject()},ObjectLikeSequence.prototype.get=function(a){var b=this.pairs().find(function(b){return b[0]===a});return b?b[1]:void 0},ObjectLikeSequence.prototype.keys=function(){return this.map(function(a,b){return b})},ObjectLikeSequence.prototype.values=function(){return this.map(function(a){return a})},ObjectLikeSequence.prototype.async=function(){throw"An ObjectLikeSequence does not support asynchronous iteration."},ObjectLikeSequence.prototype.reverse=function(){return this},ObjectLikeSequence.prototype.assign=function(a){return new AssignSequence(this,a)},ObjectLikeSequence.prototype.extend=function(a){return this.assign(a)},AssignSequence.prototype=new ObjectLikeSequence,AssignSequence.prototype.get=function(a){return this.other[a]||this.parent.get(a)},AssignSequence.prototype.each=function(a){var b=new Set,c=!1;return Lazy(this.other).each(function(d,e){return a(d,e)===!1?(c=!0,!1):void b.add(e)}),c?void 0:this.parent.each(function(c,d){return b.contains(d)||a(c,d)!==!1?void 0:!1})},ObjectLikeSequence.prototype.defaults=function a(a){return new DefaultsSequence(this,a)},DefaultsSequence.prototype=new ObjectLikeSequence,DefaultsSequence.prototype.get=function(a){return this.parent.get(a)||this.defaults[a]},DefaultsSequence.prototype.each=function(a){var b=new Set,c=!1;this.parent.each(function(d,e){return a(d,e)===!1?(c=!0,!1):void("undefined"!=typeof d&&b.add(e))}),c||Lazy(this.defaults).each(function(c,d){return b.contains(d)||a(c,d)!==!1?void 0:!1})},ObjectLikeSequence.prototype.invert=function(){return new InvertedSequence(this)},InvertedSequence.prototype=new ObjectLikeSequence,InvertedSequence.prototype.each=function(a){this.parent.each(function(b,c){return a(c,b)})},ObjectLikeSequence.prototype.merge=function(){var a=arguments.length>1&&"function"==typeof arguments[arguments.length-1]?arrayPop.call(arguments):null;return new MergedSequence(this,arraySlice.call(arguments,0),a)},MergedSequence.prototype=new ObjectLikeSequence,MergedSequence.prototype.each=function(a){var b=this.others,c=this.mergeFn||mergeObjects,d={},e=this.parent.each(function(e,f){var g=e;return forEach(b,function(a){f in a&&(g=c(g,a[f]))}),d[f]=!0,a(g,f)});if(e===!1)return!1;var f={};return forEach(b,function(a){for(var b in a)d[b]||(f[b]=c(f[b],a[b]))}),Lazy(f).each(a)},ObjectLikeSequence.prototype.functions=function(){return this.filter(function(a){return"function"==typeof a}).map(function(a,b){return b})},ObjectLikeSequence.prototype.methods=function(){return this.functions()},ObjectLikeSequence.prototype.pick=function(a){return new PickSequence(this,a)},PickSequence.prototype=new ObjectLikeSequence,PickSequence.prototype.get=function(a){return arrayContains(this.properties,a)?this.parent.get(a):void 0},PickSequence.prototype.each=function(a){var b=arrayContains,c=this.properties;return this.parent.each(function(d,e){return b(c,e)?a(d,e):void 0})},ObjectLikeSequence.prototype.omit=function(a){return new OmitSequence(this,a)},OmitSequence.prototype=new ObjectLikeSequence,OmitSequence.prototype.get=function(a){return arrayContains(this.properties,a)?void 0:this.parent.get(a)},OmitSequence.prototype.each=function(a){var b=arrayContains,c=this.properties;return this.parent.each(function(d,e){return b(c,e)?void 0:a(d,e)})},ObjectLikeSequence.prototype.pairs=function(){return this.map(function(a,b){return[b,a]})},ObjectLikeSequence.prototype.toArray=function(){return this.pairs().toArray()},ObjectLikeSequence.prototype.toObject=function(){return this.reduce(function(a,b,c){return a[c]=b,a},{})},GroupedSequence.prototype=new ObjectLikeSequence,GroupedSequence.prototype.each=function(a){var b=createCallback(this.keyFn),c={};this.parent.each(function(a){var d=b(a);c[d]?c[d].push(a):c[d]=[a]});for(var d in c)if(a(c[d],d)===!1)return!1;return!0},CountedSequence.prototype=new ObjectLikeSequence,CountedSequence.prototype.each=function(a){var b=createCallback(this.keyFn),c={};this.parent.each(function(a){var d=b(a);
c[d]?c[d]+=1:c[d]=1});for(var d in c)if(a(c[d],d)===!1)return!1;return!0},ObjectLikeSequence.prototype.watch=function(){throw"You can only call #watch on a directly wrapped object."},ObjectWrapper.prototype=new ObjectLikeSequence,ObjectWrapper.prototype.root=function(){return this},ObjectWrapper.prototype.get=function(a){return this.source[a]},ObjectWrapper.prototype.each=function(a){var b,c=this.source;for(b in c)if(a(c[b],b)===!1)return!1;return!0},StringLikeSequence.prototype=new ArrayLikeSequence,StringLikeSequence.define=function(a,b){if(!b||"function"!=typeof b.get)throw"A custom string-like sequence must implement *at least* get!";return defineSequenceType(StringLikeSequence,a,b)},StringLikeSequence.prototype.value=function(){return this.toString()},StringLikeSequence.prototype.getIterator=function(){return new CharIterator(this)},CharIterator.prototype.current=function(){return this.source.charAt(this.index)},CharIterator.prototype.moveNext=function(){return++this.index<this.source.length()},StringLikeSequence.prototype.charAt=function(a){return this.get(a)},StringLikeSequence.prototype.charCodeAt=function(a){var b=this.charAt(a);return b?b.charCodeAt(0):0/0},StringLikeSequence.prototype.substring=function(a,b){return new StringSegment(this,a,b)},StringSegment.prototype=new StringLikeSequence,StringSegment.prototype.get=function(a){return this.parent.get(a+this.start)},StringSegment.prototype.length=function(){return("number"==typeof this.stop?this.stop:this.parent.length())-this.start},StringLikeSequence.prototype.first=function(a){return"undefined"==typeof a?this.charAt(0):this.substring(0,a)},StringLikeSequence.prototype.last=function(a){return"undefined"==typeof a?this.charAt(this.length()-1):this.substring(this.length()-a)},StringLikeSequence.prototype.drop=function(a){return this.substring(a)},StringLikeSequence.prototype.indexOf=function(a,b){return this.toString().indexOf(a,b)},StringLikeSequence.prototype.lastIndexOf=function(a,b){return this.toString().lastIndexOf(a,b)},StringLikeSequence.prototype.contains=function(a){return-1!==this.indexOf(a)},StringLikeSequence.prototype.endsWith=function(a){return this.substring(this.length()-a.length).toString()===a},StringLikeSequence.prototype.startsWith=function(a){return this.substring(0,a.length).toString()===a},StringLikeSequence.prototype.toUpperCase=function(){return this.mapString(function(a){return a.toUpperCase()})},StringLikeSequence.prototype.toLowerCase=function(){return this.mapString(function(a){return a.toLowerCase()})},StringLikeSequence.prototype.mapString=function(a){return new MappedStringLikeSequence(this,a)},MappedStringLikeSequence.prototype=new StringLikeSequence,MappedStringLikeSequence.prototype.get=IndexedMappedSequence.prototype.get,MappedStringLikeSequence.prototype.length=IndexedMappedSequence.prototype.length,StringLikeSequence.prototype.reverse=function(){return new ReversedStringLikeSequence(this)},ReversedStringLikeSequence.prototype=new StringLikeSequence,ReversedStringLikeSequence.prototype.get=IndexedReversedSequence.prototype.get,ReversedStringLikeSequence.prototype.length=IndexedReversedSequence.prototype.length,StringLikeSequence.prototype.toString=function(){return this.join("")},StringLikeSequence.prototype.match=function(a){return new StringMatchSequence(this.source,a)},StringMatchSequence.prototype=new Sequence,StringMatchSequence.prototype.getIterator=function(){return new StringMatchIterator(this.source,this.pattern)},StringMatchIterator.prototype.current=function(){return this.match[0]},StringMatchIterator.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))},StringLikeSequence.prototype.split=function(a){return new SplitStringSequence(this.source,a)},SplitStringSequence.prototype=new Sequence,SplitStringSequence.prototype.getIterator=function(){return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new CharIterator(this.source):new SplitWithRegExpIterator(this.source,this.pattern):""===this.pattern?new CharIterator(this.source):new SplitWithStringIterator(this.source,this.pattern)},SplitWithRegExpIterator.prototype.current=function(){return this.source.substring(this.start,this.end)},SplitWithRegExpIterator.prototype.moveNext=function(){if(!this.pattern)return!1;var a=this.pattern.exec(this.source);return a?(this.start=this.nextStart?this.nextStart:0,this.end=a.index,this.nextStart=a.index+a[0].length,!0):this.pattern?(this.start=this.nextStart,this.end=void 0,this.nextStart=void 0,this.pattern=void 0,!0):!1},SplitWithStringIterator.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)},SplitWithStringIterator.prototype.moveNext=function(){return this.finished||(this.leftIndex="undefined"!=typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex)),-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished},StringWrapper.prototype=new StringLikeSequence,StringWrapper.prototype.root=function(){return this},StringWrapper.prototype.get=function(a){return this.source.charAt(a)},StringWrapper.prototype.length=function(){return this.source.length},GeneratedSequence.prototype=new Sequence,GeneratedSequence.prototype.length=function(){return this.fixedLength},GeneratedSequence.prototype.each=function(a){for(var b=this.get,c=this.fixedLength,d=0;"undefined"==typeof c||c>d;)if(a(b(d++))===!1)return!1;return!0},GeneratedSequence.prototype.getIterator=function(){return new GeneratedIterator(this)},GeneratedIterator.prototype.current=function(){return this.currentValue},GeneratedIterator.prototype.moveNext=function(){var a=this.sequence;return"number"==typeof a.fixedLength&&this.index>=a.fixedLength?!1:(this.currentValue=a.get(this.index++),!0)},AsyncSequence.prototype=new Sequence,AsyncSequence.prototype.getIterator=function(){throw"An AsyncSequence does not support synchronous iteration."},AsyncSequence.prototype.each=function(a){var b=this.parent.getIterator(),c=this.onNextCallback,d=0,e=new AsyncHandle(this.interval);return e.id=c(function f(){try{b.moveNext()&&a(b.current(),d++)!==!1?e.id=c(f):e.completeCallback()}catch(g){e.errorCallback(g)}}),e},AsyncHandle.prototype.cancel=function(){var a=this.cancelCallback;this.id&&(a(this.id),this.id=null)},AsyncHandle.prototype.onError=function(a){this.errorCallback=a},AsyncHandle.prototype.errorCallback=Lazy.noop,AsyncHandle.prototype.onComplete=function(a){this.completeCallback=a},AsyncHandle.prototype.completeCallback=Lazy.noop,AsyncSequence.prototype.reverse=function(){return this.parent.reverse().async()},AsyncSequence.prototype.reduce=function(a,b){var c=this.each(function(c,d){b="undefined"==typeof b&&0===d?c:a(b,c,d)});return c.then=c.onComplete=function(a){c.completeCallback=function(){a(b)}},c},AsyncSequence.prototype.find=function(a){var b,c=this.each(function(c,d){return a(c,d)?(b=c,!1):void 0});return c.then=c.onComplete=function(a){c.completeCallback=function(){a(b)}},c},AsyncSequence.prototype.indexOf=function(a){var b=-1,c=this.each(function(c,d){return c===a?(b=d,!1):void 0});return c.then=c.onComplete=function(a){c.completeCallback=function(){a(b)}},c},AsyncSequence.prototype.contains=function(a){var b=!1,c=this.each(function(c){return c===a?(b=!0,!1):void 0});return c.then=c.onComplete=function(a){c.completeCallback=function(){a(b)}},c},AsyncSequence.prototype.async=function(){return this},ObjectWrapper.prototype.watch=function(a){return new WatchedPropertySequence(this.source,a)},WatchedPropertySequence.prototype=new AsyncSequence,WatchedPropertySequence.prototype.each=function(a){this.listeners.push(a)},StreamLikeSequence.prototype=new AsyncSequence,StreamLikeSequence.prototype.split=function(a){return new SplitStreamSequence(this,a)},SplitStreamSequence.prototype=new Sequence,SplitStreamSequence.prototype.each=function(a){var b=this.delimiter,c=!1,d=0;return this.parent.each(function(e){return Lazy(e).split(b).each(function(b){return a(b,d++)===!1?(c=!0,!1):void 0}),!c})},StreamLikeSequence.prototype.lines=function(){return this.split("\n")},StreamLikeSequence.prototype.match=function(a){return new MatchedStreamSequence(this,a)},MatchedStreamSequence.prototype=new AsyncSequence,MatchedStreamSequence.prototype.each=function(a){var b=this.pattern,c=!1,d=0;return this.parent.each(function(e){return Lazy(e).match(b).each(function(b){return a(b,d++)===!1?(c=!0,!1):void 0}),!c})},Lazy.createWrapper=function(a){var b=function(){this.listeners=[]};return b.prototype=new StreamLikeSequence,b.prototype.each=function(a){this.listeners.push(a)},b.prototype.emit=function(a){for(var b=this.listeners,c=b.length,d=c-1;d>=0;--d)b[d](a)===!1&&b.splice(d,1)},function(){var c=new b;return a.apply(c,arguments),c}},Lazy.generate=function(a,b){return new GeneratedSequence(a,b)},Lazy.range=function(){var a=arguments.length>1?arguments[0]:0,b=arguments.length>1?arguments[1]:arguments[0],c=arguments.length>2?arguments[2]:1;return this.generate(function(b){return a+c*b}).take(Math.floor((b-a)/c))},Lazy.repeat=function(a,b){return Lazy.generate(function(){return a},b)},Lazy.Sequence=Sequence,Lazy.ArrayLikeSequence=ArrayLikeSequence,Lazy.ObjectLikeSequence=ObjectLikeSequence,Lazy.StringLikeSequence=StringLikeSequence,Lazy.StreamLikeSequence=StreamLikeSequence,Lazy.GeneratedSequence=GeneratedSequence,Lazy.AsyncSequence=AsyncSequence,Lazy.AsyncHandle=AsyncHandle,Lazy.deprecate=function(a,b){return function(){return b.apply(this,arguments)}};var arrayPop=Array.prototype.pop,arraySlice=Array.prototype.slice;Set.prototype.add=function(a){var b,c=this.table,d=typeof a;switch(d){case"number":case"boolean":case"undefined":return c[a]?!1:(c[a]=!0,!0);case"string":switch(a.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":a="@"+a}return c[a]?!1:(c[a]=!0,!0);default:return b=this.objects,arrayContains(b,a)?!1:(b.push(a),!0)}},Set.prototype.contains=function(a){var b=typeof a;switch(b){case"number":case"boolean":case"undefined":return!!this.table[a];case"string":switch(a.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":a="@"+a}return!!this.table[a];default:return arrayContains(this.objects,a)}},Queue.prototype.add=function(a){var b=this.contents,c=b.length,d=this.start;return this.count===c?(b[d]=a,this.start=(d+1)%c):b[this.count++]=a,this},Queue.prototype.toArray=function(){var a=this.contents,b=this.start,c=this.count,d=a.slice(b,b+c);return d.length<c&&(d=d.concat(a.slice(0,c-d.length))),d},"object"==typeof module&&module&&module.exports===context?module.exports=Lazy:context.Lazy=Lazy}(this),function(a){a.JSOL||(a.JSOL={});var b=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;"function"!=typeof a.JSOL.parse&&(a.JSOL.parse=function(a){var c=a.replace(/\n/,"");if("string"!=typeof c||!c)return null;if(c=c.replace(b,""),c=c.replace(/'/g,'"'),/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,":").replace(/\w*\s*\:/g,":")))return new Function("return "+c)();throw"Invalid JSOL: "+c})}(window),angular.module("services.templateRetriever",[]).factory("templateRetriever",["$http","$q",function(a,b){return{getTemplate:function(c,d){var e=b.defer();return a({url:c,method:"GET",headers:{"Content-Type":"text/html"},tracker:d||"promiseTracker"}).success(function(a){e.resolve(a)}).error(function(a,b,c,d){e.reject({data:a,status:b,headers:c,config:d})}),e.promise}}}]),angular_ui_form_validations=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;h=[],a=[];var o=function(a,b,c){if("undefined"!=typeof c.validationSubmit){var d=e(c.validationSubmit,"onSubmit",!0),f=e(c.validationSubmit,"formName",!0),g=angular.element("[name="+f+"]");0===g.length&&(g=b.parents("[name="+f+"]")),d=d.substring(0,d.indexOf("("));var h=a[d],i=d.indexOf(".");if(-1!==i){var j=d.substring(0,i),k=d.substring(i+1);h=a[j][k]}var l=!1;b.addClass("invalid"),b.removeClass("valid");var m=function(){l=!0,b.addClass("valid"),b.removeClass("invalid")},n=function(){l=!1,b.addClass("invalid"),b.removeClass("valid")};a.$watch(function(b){return b[f].$valid&&a[f].$dirty===!0},function(a){a===!0?m():n()}),b.on("click",function(){l===!0&&h.apply(a,[])})}};return k={customValidationAttribute:"validationDynamicallyDefined",errorCount:0,latestElement:null,_errorMessage:"Field is invalid",_success:function(){},success:function(){return k._success&&k._success.apply(this,arguments)},errorMessage:function(){return k._errorMessage},validator:function(a,b,c,d,e,f,g){var h,i,j,l,m,n;return n=arguments,j=g[c],i=function(a){return k._errorMessage=a.errorMessage,k._success=a.success,a},l=function(a,b){var c,d;return c="validationdynamicallydefined",c+=a.identifier&&""!==a.identifier&&null!==a.identifier?a.identifier.charAt(0).toUpperCase()+a.identifier.slice(1).toLowerCase():b,d=angular.copy(a),d.identifier=c,d},m=function(a){return h=a.validator.apply(g,n),f.$setValidity(a.identifier,h),h===!0},Lazy(j).map(i).map(l).map(m).each(function(a){return a===!1?(k.errorCount++,k.latestElement=d,!1):!0}),h}},onValidationComplete=function(a,b,c,d,e,f,g,h){a?(d.addClass("ValidationLiveSuccess"),h.call(this,b,c,d,e,f,g)):d.removeClass("ValidationLiveSuccess")},i=function(a){var b=!1;return Lazy(h).each(function(c){return c.attr("templateUid")===a.attr("templateUid")?(b=!0,j=c,!1):!0}),b},e=function(a,b,c){var d;if(void 0===a)return void 0;b=b||"value",d=a;try{var e=JSOL.parse(a)}catch(f){}return null!==e&&"object"==typeof e?(e.hasOwnProperty(b)?(hasProperty=!0,d=e[b]):(hasProperty=!1,d=void 0,c!==!0&&(d=e.value)),d):c===!0?void 0:d},getValidationAttributeByPropertyName=function(a,b){var c;try{c=JSOL.parse(a)[b]}catch(d){c=null}return c},g=function(a,b){var c,d,e;c=l.defer(),e=c.promise;try{d=JSOL.parse(a).template,void 0===d||null===d||""===d?c.reject("No template url specified."):e=b.getTemplate(d)}catch(f){c.reject("Error retrieving custom error template: "+f)}return e},f=function(b){var c;return Lazy(a).each(function(a){return a.customValidationAttribute===b?(c=a.validator,!1):!0}),c},d=function(b){var c;return Lazy(a).each(function(a,d){return a.customValidationAttribute===b?(c=d,!1):!0}),c},b=function(a,b,c,o,p){return l=c,m=o,n=p,function(c,l,n,o){var p,q,r,s,t,u,v,w,x;m(function(){var m,y,z,A,B,C,D,E=n[a.customValidationAttribute];w=e(E),A=w&&"undefined"!==w&&"false"!==w,m=function(){var b="";return/checkbox|radio/.test(l[0].type)&&(b="checkboxradioerror "),angular.element("<span data-custom-validation-priorityIndex="+d(a.customValidationAttribute)+" data-custom-validation-attribute="+a.customValidationAttribute+" data-custom-field-name="+l.attr("name")+' class="CustomValidationError '+b+a.customValidationAttribute+" "+u+'property">'+q+"</span>")},y=function(){c.$watch(function(){return k.errorCount},function(){if(0!==k.errorCount){var a=r.attr("data-custom-field-name"),b=k.latestElement.attr("name");b===a&&r.html(k.errorMessage())}})},z=function(a){var b;x=angular.element(a),x.html(""),b=function(){var a=Math.random();"inline"===r.css("display")||"block"===r.css("display")?(l.attr("templateUid",a),x.attr("templateUid",a),r.wrap(x),h.push(angular.element(r.parents()[0]))):(l.removeAttr("templateUid"),r.parent().is("."+x.attr("class"))&&r.unwrap(x))},c.$watch(function(){return r.css("display")},b),c.$on("errorMessageToggled",b)},B=function(){var b;return b="function"==typeof a.errorMessage?a.errorMessage(w):a.errorMessage},C=function(){q=B(),r=m(),l.after(r),r.hide(),"validationDynamicallyDefined"===a.customValidationAttribute&&y(),g(n[a.customValidationAttribute],b).then(function(a){z(a)}),p=getValidationAttributeByPropertyName(n[a.customValidationAttribute],"message"),null!==p&&r.html(p)},D=function(){if("validationNoSpace"===a.customValidationAttribute&&l.keyup(function(a){8===a.keyCode&&(t[u]=l.val().replace(/\s+$/,""))}),"validationConfirmPassword"===a.customValidationAttribute){var b="#"+l.attr("passwordFieldId");return void l.add(b).on("keyup blur",function(){var d,e,f,g,h;e=this.hasAttribute("passwordFieldId")===!0?angular.element(this):angular.element(this).siblings("[passwordFieldId="+this.id+"]"),f=e.siblings(b),g=/dirty/.test(e.attr("class")),g!==!1&&(h=/invalid/.test(f.attr("class"))===!1,d=$(b).val()===l.val(),o.$setValidity("validationconfirmpassword",d),e.siblings(".CustomValidationError.validationConfirmPassword:first").toggle(!d),onValidationComplete(d,d,w,l,t,o,c,a.success||function(){}))})}"validationFieldRequired"===a.customValidationAttribute&&l.parents("form").find("label[for="+l.attr("id")+"]").addClass("requiredFieldLabel")},v=function(b){function g(){var a,b;return a='[data-custom-field-name="'+l.attr("name")+'"]',b='.CustomValidationError[style="display: inline;"]'+a+', .CustomValidationError[style="display: block;"]'+a,i(l)?j.children(b):l.siblings(b)}function h(){var a=l.val().replace(/\s+$/,"");return/select/.test(l[0].type)&&(a=l[0].options[l[0].selectedIndex].innerHTML),/checkbox|radio/.test(l[0].type)&&(a=l[0].checked===!0?"true":""),a}function k(){""===y?l.parents("form").find("label[for="+l.attr("id")+"]").addClass("requiredFieldLabel"):l.parents("form").find("label[for="+l.attr("id")+"]").removeClass("requiredFieldLabel")}function m(){return a.validator(r,y,w,l,t,o,c,E)}function p(a){return a.replace(".","\\.")}function q(){var b=".CustomValidationError."+a.customValidationAttribute+"."+p(u)+"property:first";l.siblings(b).toggle(!x)}function s(){D=f(B.attr("data-custom-validation-attribute")),C=D(r.clone(),y,n[B.attr("data-custom-validation-attribute")],l,t,o,c,E),F=parseInt(B.attr("data-custom-validation-priorityIndex"),10),G=F>=d(a.customValidationAttribute),(C||!C&&G&&!x)&&(B.hide(),l.siblings(".CustomValidationError."+a.customValidationAttribute+"."+p(u)+"property:first").toggle(!x))}function v(){D=f(B.attr("data-custom-validation-attribute")),C=D(r,y,e(n[B.attr("data-custom-validation-attribute")]),l,t,o),F=parseInt(B.attr("data-custom-validation-priorityIndex"),10),G=F>=d(a.customValidationAttribute),(C||!C&&G&&!x&&-1===j.children().attr("class").indexOf(a.customValidationAttribute))&&(B.hide(),l.siblings(".CustomValidationError."+a.customValidationAttribute+"."+p(u)+"property:first").toggle(!x),c.$broadcast("errorMessageToggled"))}var x,y,z,A,B,C,D,F,G,H,I=!1;if("blur"!==b&&"runCustomValidations"!==b&&(a.validateWhileEntering&&a.validateWhileEntering===!0||(I=!0)),!l.hasClass("ng-pristine")||"runCustomValidations"===b){H=a.success||function(){},B=g(),A=B.length>0,y=h(),"validationFieldRequired"===a.customValidationAttribute&&k(),x=I===!0?!0:m(),o.$setValidity(a.customValidationAttribute.toLowerCase(),x);var J=x===!0?" passed":" failed";return z={isValid:x,validation:l.attr("id")+" "+a.customValidationAttribute+J,model:t,controller:o,element:l},A?i(l)||s():q(),i(l)&&v(),c.$broadcast("customValidationComplete",z),onValidationComplete(!(A||i(l)||!x),y,w,l,t,o,c,H),y}},A===!0&&(s=n.ngModel.substring(0,n.ngModel.indexOf(".")),u=n.ngModel.substring(n.ngModel.indexOf(".")+1),t=c[s],C(),D(),o.$parsers.push(function(){return v("input")}),l.on("blur",function(a){v(a.type)}),c.$on("runCustomValidations",function(){v("runCustomValidations")}))})}},c=angular.module("directives.customvalidation.customValidations",["directives.invalidinputformatter.invalidInputFormatter","services.templateRetriever"]).factory("customValidationUtil",["templateRetriever","$q","$timeout","$log",function(c,d,e,f){return{createValidationLink:function(g){return a.push(g),b(g,c,d,e,f)}}}]).directive("input",["customValidationUtil",function(a){return{require:"?ngModel",restrict:"E",link:a.createValidationLink(k)}}]).directive("select",["customValidationUtil",function(a){return{require:"?ngModel",restrict:"E",link:a.createValidationLink(k)}}]).directive("select",["customValidationUtil",function(a){return{require:"?ngModel",restrict:"E",link:a.createValidationLink({customValidationAttribute:"validationFieldRequired",validateWhileEntering:!0,errorMessage:"This is a required field",validator:function(a,b){return/\S/.test(b)}})}}]).directive("button",["customValidationUtil",function(){return{restrict:"E",link:o}}]).directive("a",["customValidationUtil",function(){return{restrict:"E",link:o}}]),{getValidationAttributeValue:e}}(),function(){var a=angular.module("directives.customvalidation.customValidationTypes",["directives.customvalidation.customValidations"]);a.provider("myValidations",function(){getValidationAttributeValue=angular_ui_form_validations.getValidationAttributeValue;var a=[{customValidationAttribute:"validationFieldRequired",errorMessage:"This is a required field",validator:function(a,b){return/\S/.test(b)}},{customValidationAttribute:"validationConfirmPassword",errorMessage:"Passwords do not match.",validator:function(a,b,c,d,e){var f=e.password||"";return f.replace(/\s+$/,"")===d.val().replace(/\s+$/,"")}},{customValidationAttribute:"validationEmail",errorMessage:"Please enter a valid email",validator:function(a,b){return/^.*@.*\..*[a-z]$/i.test(b)}},{customValidationAttribute:"validationNoSpace",errorMessage:"Cannot contain any spaces",validateWhileEntering:!0,validator:function(a,b){return""!==b&&/^[^\s]+$/.test(b)}},{customValidationAttribute:"validationMinLength",errorMessage:function(a){return"Minimum of "+getValidationAttributeValue(a)+" characters"},validator:function(a,b,c){return b.length>=parseInt(getValidationAttributeValue(c),10)}},{customValidationAttribute:"validationMaxLength",errorMessage:"",validateWhileEntering:!0,validator:function(a,b,c,d,e,f,g,h){var i=getValidationAttributeValue(h,"message",!0);return b.length<=parseInt(getValidationAttributeValue(h),10)?!0:(a.html(i||"Maximum of "+getValidationAttributeValue(h)+" characters"),!1)}},{customValidationAttribute:"validationOnlyAlphabets",errorMessage:"Valid characters are: A-Z, a-z",validateWhileEntering:!0,validator:function(a,b){return/^[a-z]*$/i.test(b)}},{customValidationAttribute:"validationOneUpperCaseLetter",errorMessage:"Must contain at least one uppercase letter",validator:function(a,b){return/^(?=.*[A-Z]).+$/.test(b)}},{customValidationAttribute:"validationOneLowerCaseLetter",errorMessage:"Must contain at least one lowercase letter",validator:function(a,b){return/^(?=.*[a-z]).+$/.test(b)}},{customValidationAttribute:"validationOneNumber",errorMessage:"Must contain at least one number",validator:function(a,b){return/^(?=.*[0-9]).+$/.test(b)}},{customValidationAttribute:"validationOneAlphabet",errorMessage:"Must contain at least one alphabet",validator:function(a,b){return/^(?=.*[a-z]).+$/i.test(b)}},{customValidationAttribute:"validationNoSpecialChars",validateWhileEntering:!0,errorMessage:"Valid characters are: A-Z, a-z, 0-9",validator:function(a,b){return/^[a-z0-9_\-\s]*$/i.test(b)}},{customValidationAttribute:"validationDateBeforeToday",errorMessage:"Must be prior to today",validator:function(a,b){var c,d;return c=new Date,d=new Date(b),d.setDate(d.getDate()+1),c>d}},{customValidationAttribute:"validationDateBefore",errorMessage:function(a){return"Must be before "+getValidationAttributeValue(a)},validator:function(a,b,c){var d=new Date(b);return d.setDate(d.getDate()+1),d<new Date(c)}},{customValidationAttribute:"validationDateAfter",errorMessage:function(a){return"Must be after "+getValidationAttributeValue(a)},validator:function(a,b,c){var d=new Date(b);return d.setDate(d.getDate()+1),d.setHours(0),d>new Date(c)}}],b=[];this.addCustomValidations=function(a){b=b.concat(a)};var c;this.setCompileProvider=function(a){c=a};var d=function(){this.compileDirective=function(a,b){c.directive.apply(null,[a,b])},this.fetch=function(){return b.concat(a)}};this.$get=function(){return new d}}),a.config(["$compileProvider","myValidationsProvider",function(a,b){b.setCompileProvider(a)}]),a.run(["myValidations",function(a){angular.forEach(a.fetch(),function(b){a.compileDirective("input",function(a){return{require:"?ngModel",restrict:"E",link:a.createValidationLink(b)}}),a.compileDirective("textarea",function(a){return{require:"?ngModel",restrict:"E",link:a.createValidationLink(b)}})})}])}(),angular.module("directives.invalidinputformatter.invalidInputFormatter",[]).directive("input",function(){return{require:"?ngModel",restrict:"E",link:function(a,b,c,d){var e=angular.lowercase(c.type);d&&"radio"!==e&&"checkbox"!==e&&d.$formatters.unshift(function(a){return d.$invalid&&angular.isUndefined(a)&&"string"==typeof d.$modelValue?d.$modelValue:a})}}});